<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentic RAG â€” Multi-Agent System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #0d1117; --surface: #161b22; --surface2: #1c2333;
            --border: #30363d; --text: #e6edf3; --text2: #8b949e;
            --accent: #58a6ff; --green: #3fb950; --orange: #d29922;
            --purple: #bc8cff; --pink: #f778ba; --red: #f85149;
        }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; height: 100vh; display: flex; overflow: hidden; }

        /* Sidebar */
        .sidebar { width: 300px; background: var(--surface); border-right: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); }
        .sidebar-header h2 { font-size: 14px; color: var(--text2); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
        .kb-list { flex: 1; overflow-y: auto; padding: 12px; }
        .kb-card { background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 14px; margin-bottom: 10px; cursor: default; transition: border-color .2s; }
        .kb-card:hover { border-color: var(--accent); }
        .kb-card h3 { font-size: 14px; margin-bottom: 6px; }
        .kb-card .meta { font-size: 12px; color: var(--text2); }
        .kb-card .meta span { margin-right: 12px; }
        .kb-form { padding: 12px; border-top: 1px solid var(--border); }
        .kb-form input, .kb-form textarea { width: 100%; padding: 8px 10px; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 13px; margin-bottom: 8px; resize: none; }
        .kb-form input:focus, .kb-form textarea:focus { outline: none; border-color: var(--accent); }

        /* Main area */
        .main { flex: 1; display: flex; flex-direction: column; min-width: 0; }
        .topbar { padding: 16px 24px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 16px; }
        .topbar h1 { font-size: 20px; font-weight: 600; }
        .topbar .badge { background: var(--purple); color: #fff; padding: 3px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .content { flex: 1; display: flex; overflow: hidden; }

        /* Chat panel */
        .chat-panel { flex: 1; display: flex; flex-direction: column; min-width: 0; }
        .messages { flex: 1; overflow-y: auto; padding: 24px; }
        .message { margin-bottom: 20px; max-width: 85%; }
        .message.user { margin-left: auto; }
        .message .bubble { padding: 14px 18px; border-radius: 12px; font-size: 14px; line-height: 1.6; }
        .message.user .bubble { background: #1f3a5f; border: 1px solid #2d4a6f; }
        .message.assistant .bubble { background: var(--surface2); border: 1px solid var(--border); }
        .message .bubble p { margin-bottom: 8px; }
        .message .bubble p:last-child { margin-bottom: 0; }
        .message .bubble ul, .message .bubble ol { padding-left: 20px; margin-bottom: 8px; }
        .message .bubble h1,.bubble h2,.bubble h3 { margin: 12px 0 6px; font-size: 15px; color: var(--accent); }
        .message .bubble code { background: var(--bg); padding: 2px 6px; border-radius: 4px; font-size: 13px; }
        .message .bubble strong { color: var(--accent); }
        .message-meta { font-size: 11px; color: var(--text2); margin-top: 6px; padding: 0 4px; }

        .input-area { padding: 16px 24px; border-top: 1px solid var(--border); }
        .input-wrapper { display: flex; gap: 10px; }
        .input-wrapper input { flex: 1; padding: 12px 16px; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; color: var(--text); font-size: 14px; }
        .input-wrapper input:focus { outline: none; border-color: var(--accent); }
        .input-wrapper input::placeholder { color: var(--text2); }

        /* Trace panel */
        .trace-panel { width: 380px; background: var(--surface); border-left: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; }
        .trace-header { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .trace-header h2 { font-size: 14px; color: var(--text2); text-transform: uppercase; letter-spacing: 1px; }
        .trace-content { flex: 1; overflow-y: auto; padding: 16px; }

        /* Timeline */
        .timeline { position: relative; }
        .timeline::before { content: ''; position: absolute; left: 18px; top: 0; bottom: 0; width: 2px; background: var(--border); }
        .tl-item { position: relative; padding-left: 48px; margin-bottom: 20px; }
        .tl-icon { position: absolute; left: 6px; top: 0; width: 26px; height: 26px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; z-index: 1; }
        .tl-icon.router { background: #1f3a5f; }
        .tl-icon.research { background: #1a3d2a; }
        .tl-icon.analyst { background: #3d2a1a; }
        .tl-icon.writer { background: #2a1a3d; }
        .tl-card { background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 12px; }
        .tl-card .agent-name { font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: .5px; margin-bottom: 6px; }
        .tl-card .agent-name.router { color: var(--accent); }
        .tl-card .agent-name.research { color: var(--green); }
        .tl-card .agent-name.analyst { color: var(--orange); }
        .tl-card .agent-name.writer { color: var(--purple); }
        .tl-card .reasoning { font-size: 12px; color: var(--text2); line-height: 1.5; margin-top: 4px; }
        .tl-card .stats { font-size: 11px; color: var(--text2); margin-top: 8px; display: flex; gap: 12px; flex-wrap: wrap; }
        .tl-card .stats .stat { background: var(--bg); padding: 2px 8px; border-radius: 4px; }

        /* Trace summary */
        .trace-summary { background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 14px; margin-bottom: 16px; }
        .trace-summary .row { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px; }
        .trace-summary .row:last-child { margin-bottom: 0; }
        .trace-summary .label { color: var(--text2); }
        .trace-summary .value { font-weight: 600; }

        /* Buttons */
        .btn { padding: 8px 16px; border: none; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all .2s; }
        .btn-primary { background: var(--accent); color: #fff; }
        .btn-primary:hover { background: #79b8ff; }
        .btn-primary:disabled { opacity: .5; cursor: not-allowed; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .btn-ghost { background: transparent; color: var(--text2); border: 1px solid var(--border); }
        .btn-ghost:hover { color: var(--text); border-color: var(--text2); }

        /* Doc modal */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.6); z-index: 100; align-items: center; justify-content: center; }
        .modal-overlay.show { display: flex; }
        .modal { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 24px; width: 500px; max-width: 90vw; max-height: 80vh; overflow-y: auto; }
        .modal h3 { margin-bottom: 16px; }
        .modal input, .modal textarea { width: 100%; padding: 10px 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 13px; margin-bottom: 12px; font-family: inherit; }
        .modal textarea { height: 200px; resize: vertical; }
        .modal .actions { display: flex; gap: 8px; justify-content: flex-end; }

        /* Welcome */
        .welcome { text-align: center; padding: 60px 40px; color: var(--text2); }
        .welcome h2 { font-size: 24px; color: var(--text); margin-bottom: 12px; }
        .welcome p { font-size: 14px; line-height: 1.6; max-width: 500px; margin: 0 auto 16px; }
        .welcome .agents { display: flex; gap: 16px; justify-content: center; margin-top: 24px; flex-wrap: wrap; }
        .welcome .agent-card { background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; padding: 16px; width: 140px; text-align: center; }
        .welcome .agent-card .icon { font-size: 28px; margin-bottom: 8px; }
        .welcome .agent-card .name { font-size: 13px; font-weight: 600; color: var(--text); }
        .welcome .agent-card .desc { font-size: 11px; color: var(--text2); margin-top: 4px; }

        /* Loading */
        .loading { display: none; align-items: center; gap: 8px; padding: 12px 18px; color: var(--text2); font-size: 13px; }
        .loading.show { display: flex; }
        .spinner { width: 16px; height: 16px; border: 2px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin .8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text2); }

        /* Traces tab */
        .traces-list { padding: 0; }
        .trace-item { padding: 10px 14px; border-bottom: 1px solid var(--border); cursor: pointer; transition: background .2s; }
        .trace-item:hover { background: var(--surface2); }
        .trace-item .query { font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 4px; }
        .trace-item .info { font-size: 11px; color: var(--text2); display: flex; gap: 10px; }

        /* Tabs */
        .tabs { display: flex; border-bottom: 1px solid var(--border); }
        .tab { flex: 1; padding: 10px; text-align: center; font-size: 12px; font-weight: 600; color: var(--text2); cursor: pointer; border-bottom: 2px solid transparent; transition: all .2s; }
        .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
        .tab:hover { color: var(--text); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>ğŸ“š Knowledge Bases</h2>
        </div>
        <div class="kb-list" id="kbList"></div>
        <div class="kb-form">
            <input type="text" id="kbName" placeholder="Nombre de la base">
            <textarea id="kbDesc" rows="2" placeholder="DescripciÃ³n (opcional)"></textarea>
            <button class="btn btn-primary btn-sm" style="width:100%" onclick="createKB()">+ Crear Base</button>
        </div>
    </div>

    <!-- Main -->
    <div class="main">
        <div class="topbar">
            <h1>ğŸ¤– Agentic RAG</h1>
            <span class="badge">Multi-Agent System</span>
            <div style="flex:1"></div>
            <button class="btn btn-ghost btn-sm" onclick="toggleTraces()">ğŸ“‹ Historial</button>
        </div>
        <div class="content">
            <div class="chat-panel">
                <div class="messages" id="messages">
                    <div class="welcome" id="welcome">
                        <h2>Sistema Multi-Agente</h2>
                        <p>Haz una pregunta y observa cÃ³mo los agentes autÃ³nomos colaboran para encontrar la mejor respuesta.</p>
                        <div class="agents">
                            <div class="agent-card">
                                <div class="icon">ğŸ§­</div>
                                <div class="name">Router</div>
                                <div class="desc">Planifica la estrategia</div>
                            </div>
                            <div class="agent-card">
                                <div class="icon">ğŸ”</div>
                                <div class="name">Research</div>
                                <div class="desc">Busca en la KB</div>
                            </div>
                            <div class="agent-card">
                                <div class="icon">ğŸ“Š</div>
                                <div class="name">Analyst</div>
                                <div class="desc">Analiza datos</div>
                            </div>
                            <div class="agent-card">
                                <div class="icon">âœï¸</div>
                                <div class="name">Writer</div>
                                <div class="desc">Compone respuesta</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <span id="loadingText">Agentes procesando...</span>
                </div>
                <div class="input-area">
                    <div class="input-wrapper">
                        <input type="text" id="queryInput" placeholder="Pregunta algo... (ej: Â¿CuÃ¡l es la situaciÃ³n econÃ³mica de PerÃº?)" onkeydown="if(event.key==='Enter')sendQuery()">
                        <button class="btn btn-primary" onclick="sendQuery()">Enviar</button>
                    </div>
                </div>
            </div>

            <!-- Trace Panel -->
            <div class="trace-panel" id="tracePanel">
                <div class="trace-header">
                    <h2>Agent Trace</h2>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('current')">Actual</div>
                    <div class="tab" onclick="switchTab('history')">Historial</div>
                </div>
                <div class="trace-content">
                    <div id="currentTrace" class="tab-content active">
                        <p style="color:var(--text2);font-size:13px;text-align:center;padding:40px 0">EnvÃ­a una pregunta para ver el trace de los agentes</p>
                    </div>
                    <div id="historyTrace" class="tab-content">
                        <div class="traces-list" id="tracesList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Document Modal -->
    <div class="modal-overlay" id="docModal">
        <div class="modal">
            <h3>ğŸ“„ Agregar Documento</h3>
            <input type="hidden" id="docKbId">
            <input type="text" id="docTitle" placeholder="TÃ­tulo del documento">
            <textarea id="docContent" placeholder="Contenido del documento..."></textarea>
            <div class="actions">
                <button class="btn btn-ghost" onclick="closeDocModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="addDocument()">Agregar</button>
            </div>
        </div>
    </div>

    <script>
        // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let isProcessing = false;

        // â”€â”€ Knowledge Bases â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function loadKBs() {
            const res = await fetch('/knowledge-bases');
            const kbs = await res.json();
            const list = document.getElementById('kbList');
            if (kbs.length === 0) {
                list.innerHTML = '<p style="color:var(--text2);font-size:13px;text-align:center;padding:20px">No hay bases de conocimiento. Crea una abajo.</p>';
                return;
            }
            list.innerHTML = kbs.map(kb => `
                <div class="kb-card">
                    <h3>ğŸ“š ${esc(kb.name)}</h3>
                    ${kb.description ? `<p style="font-size:12px;color:var(--text2);margin:4px 0 8px">${esc(kb.description)}</p>` : ''}
                    <div class="meta">
                        <span>ğŸ“„ ${kb.doc_count} docs</span>
                        <span>ğŸ§© ${kb.chunk_count} chunks</span>
                    </div>
                    <button class="btn btn-ghost btn-sm" style="margin-top:8px;width:100%" onclick="openDocModal(${kb.id})">+ Documento</button>
                </div>
            `).join('');
        }

        async function createKB() {
            const name = document.getElementById('kbName').value.trim();
            if (!name) return;
            const desc = document.getElementById('kbDesc').value.trim();
            await fetch('/knowledge-bases', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({name, description: desc || null})
            });
            document.getElementById('kbName').value = '';
            document.getElementById('kbDesc').value = '';
            loadKBs();
        }

        function openDocModal(kbId) {
            document.getElementById('docKbId').value = kbId;
            document.getElementById('docTitle').value = '';
            document.getElementById('docContent').value = '';
            document.getElementById('docModal').classList.add('show');
        }

        function closeDocModal() {
            document.getElementById('docModal').classList.remove('show');
        }

        async function addDocument() {
            const kbId = document.getElementById('docKbId').value;
            const title = document.getElementById('docTitle').value.trim();
            const content = document.getElementById('docContent').value.trim();
            if (!title || !content) return;
            closeDocModal();
            const res = await fetch(`/knowledge-bases/${kbId}/documents`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({title, content})
            });
            const data = await res.json();
            loadKBs();
        }

        // â”€â”€ Query â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function sendQuery() {
            const input = document.getElementById('queryInput');
            const query = input.value.trim();
            if (!query || isProcessing) return;
            isProcessing = true;

            document.getElementById('welcome').style.display = 'none';
            addMessage(query, 'user');
            input.value = '';

            showLoading(true);
            switchTab('current');
            document.getElementById('currentTrace').innerHTML = '<div class="loading show"><div class="spinner"></div><span>Agentes trabajando...</span></div>';

            try {
                const res = await fetch('/query', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({query})
                });
                const data = await res.json();
                addMessage(data.answer, 'assistant', data);
                renderTrace(data);
            } catch (e) {
                addMessage('Error procesando la consulta: ' + e.message, 'assistant');
            }

            showLoading(false);
            isProcessing = false;
        }

        function addMessage(text, role, data) {
            const msgs = document.getElementById('messages');
            const div = document.createElement('div');
            div.className = `message ${role}`;
            let meta = '';
            if (data) {
                meta = `<div class="message-meta">ğŸ“‹ Trace #${data.trace_id} Â· ${data.total_steps} pasos Â· ${(data.total_latency_ms/1000).toFixed(1)}s Â· Estrategia: ${data.strategy}</div>`;
            }
            div.innerHTML = `<div class="bubble">${role === 'assistant' ? renderMarkdown(text) : esc(text)}</div>${meta}`;
            msgs.appendChild(div);
            msgs.scrollTop = msgs.scrollHeight;
        }

        function renderTrace(data) {
            const ct = document.getElementById('currentTrace');
            let html = `
                <div class="trace-summary">
                    <div class="row"><span class="label">Estrategia</span><span class="value">${data.strategy}</span></div>
                    <div class="row"><span class="label">Pasos</span><span class="value">${data.total_steps}</span></div>
                    <div class="row"><span class="label">Latencia total</span><span class="value">${(data.total_latency_ms/1000).toFixed(1)}s</span></div>
                    <div class="row"><span class="label">Trace ID</span><span class="value">#${data.trace_id}</span></div>
                </div>
                <div class="timeline">
            `;
            for (const step of data.trace) {
                const agentClass = step.agent.toLowerCase();
                let statsHtml = '';
                const stats = [];
                if (step.latency_ms) stats.push(`â± ${(step.latency_ms/1000).toFixed(1)}s`);
                if (step.strategy) stats.push(`ğŸ“‹ ${step.strategy}`);
                if (step.chunks_found !== undefined) stats.push(`ğŸ“„ ${step.chunks_found} chunks`);
                if (step.top_similarity) stats.push(`ğŸ¯ ${(step.top_similarity*100).toFixed(1)}%`);
                if (step.confidence) stats.push(`ğŸ’ª ${(step.confidence*100).toFixed(0)}%`);
                if (step.insights) stats.push(`ğŸ’¡ ${step.insights.length} insights`);
                if (step.summary) stats.push(`ğŸ“ ${step.summary.substring(0, 60)}`);
                if (stats.length) {
                    statsHtml = `<div class="stats">${stats.map(s => `<span class="stat">${s}</span>`).join('')}</div>`;
                }
                html += `
                    <div class="tl-item">
                        <div class="tl-icon ${agentClass}">${step.icon}</div>
                        <div class="tl-card">
                            <div class="agent-name ${agentClass}">Paso ${step.step}: ${step.agent} Agent</div>
                            <div class="reasoning">${esc(step.reasoning || 'Procesando...')}</div>
                            ${statsHtml}
                        </div>
                    </div>
                `;
            }
            html += '</div>';
            ct.innerHTML = html;
        }

        // â”€â”€ Traces History â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function loadTraces() {
            const res = await fetch('/traces');
            const traces = await res.json();
            const list = document.getElementById('tracesList');
            if (traces.length === 0) {
                list.innerHTML = '<p style="color:var(--text2);font-size:13px;text-align:center;padding:20px">No hay traces aÃºn</p>';
                return;
            }
            list.innerHTML = traces.map(t => `
                <div class="trace-item" onclick="viewTrace(${t.id})">
                    <div class="query">${esc(t.query)}</div>
                    <div class="info">
                        <span>#${t.id}</span>
                        <span>${t.total_steps} pasos</span>
                        <span>${(t.total_latency_ms/1000).toFixed(1)}s</span>
                    </div>
                </div>
            `).join('');
        }

        async function viewTrace(id) {
            const res = await fetch(`/traces/${id}`);
            const trace = await res.json();
            switchTab('current');
            renderTrace({
                trace_id: trace.id,
                strategy: trace.agent_trace.find(s => s.strategy)?.strategy || '?',
                total_steps: trace.total_steps,
                total_latency_ms: trace.total_latency_ms,
                trace: trace.agent_trace,
            });
        }

        // â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function switchTab(name) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            if (name === 'current') {
                document.querySelector('.tabs .tab:first-child').classList.add('active');
                document.getElementById('currentTrace').classList.add('active');
            } else {
                document.querySelector('.tabs .tab:last-child').classList.add('active');
                document.getElementById('historyTrace').classList.add('active');
                loadTraces();
            }
        }

        function toggleTraces() {
            const panel = document.getElementById('tracePanel');
            panel.style.display = panel.style.display === 'none' ? 'flex' : 'none';
        }

        // â”€â”€ Utils â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function esc(s) { const d = document.createElement('div'); d.textContent = s || ''; return d.innerHTML; }

        function showLoading(on) {
            document.getElementById('loading').classList.toggle('show', on);
        }

        function renderMarkdown(text) {
            if (!text) return '';
            return text
                .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                .replace(/^- (.*$)/gm, '<li>$1</li>')
                .replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>')
                .replace(/^/, '<p>').replace(/$/, '</p>');
        }

        // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        loadKBs();
    </script>
</body>
</html>
